<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- DAO(Interface) 아래 resultType에는 DTO 지정 -->
<mapper namespace="org.silkdog.maven.hikoco.item.dao.ItemDAO">
	<!--모든 아이템 리스트-->
	<select id="list" resultType="java.util.HashMap">
		select * from HIKOCO_ITEM;
	</select>

	<!--아이템 검색-->
    <select id="search" parameterType="String" resultType="java.util.HashMap">
    select * from (
	(select * from HIKOCO_ITEM where ITEM_TITLE like CONCAT('%',#{0},'%'))
	UNION
	(select * from HIKOCO_ITEM where ITEM_MANU like CONCAT('%',#{1},'%'))
	UNION
	(select * from HIKOCO_ITEM where ITEM_VENDOR like CONCAT('%',#{2},'%'))
	UNION
	(select * from HIKOCO_ITEM where ITEM_SUMMARY like CONCAT('%',#{3},'%'))
	) item_search
    </select>

	<!--아이템 하나 선택-->
	<select id="select" parameterType="int" resultType="org.silkdog.maven.hikoco.item.dto.ItemDTO">
		select * from HIKOCO_ITEM where item_id = #{item_id}
	</select>

	<!--아이템 삽입-->
	<insert id="insert" useGeneratedKeys="true" keyProperty="item_id" parameterType="org.silkdog.maven.hikoco.item.dto.ItemDTO">
		insert into HIKOCO_ITEM (item_title, item_price, item_manu, item_vendor, item_summary, item_pic, item_detail, item_upload_date, item_last_edited_date) values(
			#{item_title},
			#{item_price},
			#{item_manu},
			#{item_vendor},
			#{item_summary},
			#{item_pic},
			#{item_detail},
			#{item_upload_date},
			#{item_last_edited_date}
		)
	</insert>

	<!-- 아이템 리스트 페이징 -->
	<select id="take_list_content" resultType="java.util.HashMap" parameterType="java.util.HashMap">
      SELECT *
      FROM (
      (select * from HIKOCO_ITEM where ITEM_TITLE like CONCAT('%',#{keword0},'%'))
      UNION
      (select * from HIKOCO_ITEM where ITEM_MANU like CONCAT('%',#{keword1},'%'))
      UNION
      (select * from HIKOCO_ITEM where ITEM_VENDOR like CONCAT('%',#{keword2},'%'))
      UNION
      (select * from HIKOCO_ITEM where ITEM_SUMMARY like CONCAT('%',#{keword3},'%'))
      ) item_search
      ORDER BY item_id DESC
      limit #{startIndexNum}, #{pageNum}
	</select>

	<!-- 페이지 갯수 -->
	<select id="count_index_num_for_max_page" resultType="int">
	   SELECT count(no)
	   FROM HIKOCO_ITEM
	</select>
</mapper>